<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    <link rel="stylesheet" type="text/css" href="ui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="ui/themes/icon.css">
    <script type="text/javascript" src="ui/jquery.min.js"></script>
    <script type="text/javascript" src="ui/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="ui/locale/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="ui/jquery.serializejson.min.js"></script>
</head>
<body>
<form id="searchForm">
    部门名称:<input name="dep1.name">
    部门电话:<input name="dep1.tele">&nbsp;&nbsp;&nbsp;
    <button id="btnSearch" type="button">查询</button>
</form>
<table id="grid"></table>
<!--弹窗-->
<div id="editDlg" class="easyui-window">
    <form id="editForm">
        <input name="dep1.uuid" type="hidden">
        <input type="hidden" name="dep.uuid">
        部门名称:<input name="dep1.name">
        <div style="height:2px;"></div>
        部门电话:<input name="dep1.tele">
    </form>
</div>
</body>
<script>
    var method = "";
    /*************入口函数**************/
    $(function () {
        $('#grid').datagrid({
            url: 'dep_listByPage.action',
            columns: [[
                {field: 'uuid', title: '部门编号', width: 100},
                {field: 'name', title: '部门名称', width: 100},
                {field: 'tele', title: '部门电话', width: 100, align: 'right'},
                {
                    field: 'a', title: '操作', width: 100, formatter: function (value, row, index) {
                    var operation = '<a href="javascript:void(0);" onclick="edit(' + row.uuid + ')">修改</a>';
                    operation += ' <a href="javascript:void(0);" onclick="del(' + row.uuid + ')">删除</a>'
                    return operation;
                }
                }
            ]],
            singleSelect: true,
            pagination: true,
            pageSize: 10,
            pageList: [5, 10, 15, 20],
            toolbar: [{
                iconCls: 'icon-add',
                text: '增加',
                handler: function () {
                    method= "add";
                    $('#editDlg').window('open');
                }
            }]
        });
        /**弹窗初始化*/
        $('#editDlg').dialog({
            title: '部门编辑',
            width: 300,
            height: 200,
            closed: true,
            modal: true,
            buttons: [{
                text: '保存',
                iconCls: 'icon-save',
                handler: function () {
                    var editData = $('#editForm').serializeJSON();
                    $.ajax({
                        url: "dep_"+method+".action",
                        data: editData,
                        dataType: 'json',//把响应回来的内容(一般是字符串)转成json对象
                        type: 'post',//post/get
                        success: function (rtn) {
                            $.messager.alert('提示', rtn.message, 'info', function () {
                                if (rtn.success) {
                                    //重新加载表格数据
                                    $('#editDlg').dialog('close');
                                    $('#editForm').form('clear');
                                    $('#grid').datagrid('load');
                                }
                            });
                        }
                    });

                }
            }, {
                text: '取消',
                iconCls: 'icon-cancel',
                handler: function () {
                    $('editForm').form('clear');
                    $('#editDlg').dialog('close');
                }
            }]
        });
    })
    /*************入口函数**************/
    /**查询函数*/
    $('#btnSearch').bind('click', function () {
        var searchData = $('#searchForm').serializeJSON();
        $('#grid').datagrid('load', searchData);
    })

    /**删除函数*/
    function del(uuid) {
        $.messager.confirm("确认", "确认要删除吗？", function (yes) {
            if (yes) {
                $.ajax({
                    url: 'dep_del.action',
                    data: {uuid: uuid},
                    dataType: 'json',//把响应回来的内容(一般是字符串)转成json对象
                    type: 'post',//post/get
                    success: function (rtn) {
                        $.messager.alert('提示', rtn.message, 'info', function () {
                            if (rtn.success) {
                                //成功时
                                //重新加载表格数据
                                $('#grid').datagrid('reload');
                            }
                        });
                    }
                });
            }
        });
    }
    /** 编辑部门信息函数*/
    function edit(uuid) {
        /**编辑前要先根据id查询数据*/
        $('#editDlg').window('open');
        /** 清空上一次的数据*/
        $('#editForm').form('clear');
        /**根据id先加载数据*/
        $('#editForm').form('load','dep_get.action?uuid='+uuid);
        /** 将按钮方法修改为update*/
        method = "update";
    }
</script>
</html>